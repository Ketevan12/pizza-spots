<!DOCTYPE html>
<html>
	<link rel="stylesheet" href="https://use.typekit.net/exa1weq.css">
<head>
  <title>Pizza Map</title>
  <style>
	
body {
  background-color:#f58f8f;
  color:rgb(36, 84, 12); /* Set text color to white for better visibility */
  font-family: riquet, sans-serif;
font-weight: 300;
font-style: normal;
display: flex;
  justify-content: center;
  align-items: center;
  height: 40vh;
  font-size: 20pt;


  background-image:
      linear-gradient(45deg, rgb(255, 0, 0) 25%, transparent 25%), 
      linear-gradient(135deg, #ccc 25%, transparent 25%),
      linear-gradient(45deg, transparent 75%, rgb(255, 0, 0) 75%),
      linear-gradient(135deg, transparent 75%, #ccc 75%);
    background-size:25px 25px; /* Must be a square */
    background-position:0 0, 12.5px 0, 12.5px -12.5px, 0px 12.5px; 

}
#overlay {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background: #000;
    opacity: .6;
    filter: alpha(opacity=60);
}
#h1{ font-family: riquet, sans-serif;
font-weight: 100;
font-style: normal;

}

    #map-wrapper {
      z-index: 1;
      padding: 10%;
      width: 80%;
      height: 10px;
      border: 10px;
     
    }
    

    
    #grades {
      align-content: center;
z-index: 1;
	width: 100px;
	height: 100px;
    position: absolute;
    top: 25px;
    right: 1581px;
    background-color: rgb(255, 0, 0);
    padding: 10px;
    border: 1px solid rgb(0, 0, 0);
    max-height: 300px;
    overflow-y: scroll;
    font-size: 14px;
    color: rgb(0, 0, 0);


  }

  #grades p {
    margin: 10;
    padding: 5px 0;
    
    
    
  }
  #word{
    font-size: 300px;
  }
#music{
  padding: 10px;
}

  #splash-page {
      position: absolute;
      width: 0;
      height: 0;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      border-left: 300px solid transparent;
      border-right: 300px solid transparent;
      border-bottom: 400px solid rgb(0, 0, 0);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: riquet, sans-serif;
font-weight: 100;
font-style: normal;
	  bottom: 30%;
	  align-items: center;

    }

 

#splash-page h1 {
  top: 140%;


  font-size: 26px;

}

#splash-page p {
	align-items: center;
  font-size: 24px;

}

#splash-page button {
	
  font-size: 40px;
  color:rgb(255, 0, 0);
  text-emphasis-color: rgb(255, 0, 0);
  font-family: riquet, sans-serif;
font-weight: 400;
font-style: normal;
border-radius: 150%;
background-color: rgb(255, 0, 0);
}

#distanceLabel{
  font-size: 100%;
	size: 10vh;
}
#p{
	color: blue;
}
#distance{
	width: 100%;
	color: blue;
	text-decoration-line: underline;
}
#map {
     color: red;
      height: 500px;
      width: 100%;
	  filter:opacity(100%);
	  color-interpolation-filters: sRGB;
    filter: brightness(150%);
	  filter: contrast(10%);
	  filter: hue-rotate(125deg);
 

	border-color: black;
  border: 10px;
    }
	#info-box {
    z-index: 1;
	width: 22%;
	height: 18%;
    top: 3px;
    right: 10px;
    background-color: rgb(255, 109, 109);
    padding: 25px;
    border: 1px solid rgb(0, 0, 0);
    max-height: 300px;
    overflow-y: scroll;
    font-size: 12px;
    color: rgb(0, 103, 3);
    outline: #ccc;
bottom: 1in;
position: fixed;
}
#piz{
  z-index: 1;
  text-align: right;
  color: rgb(0, 0, 0);
  position:unset;  padding-bottom: 200px;
}
 #user-marker-label {
    color: green;
  }
  .green-circle {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-color: green;
        position: absolute;
      }
  </style>
</head>


  <div id="map-wrapper">
    <div id="map"></div>
	<div id="info-box"><h3>A: Most likely won't make you sick</h3>
    <h3>B or C :The facility did not meet minimum health standards and you might get sick</h3>
  <h3>N: Not yet graded, try it out</h3>
    <h3>P: Pending grade</h3>
  
    <div id="piz"> Explore the wonderful world of NYC Pizza spots</div>
  </div>

  <div id="splash-page">
    
    <h2>Pizza</h2>

      <h3>Pizza</h3>

      <h4>Pizza</h4>

      <h5>Pizza</h5>

      <h6>Pizza</h6>
    <button onclick="initMap()">O</label>
     
  </div>
 
  <div id="map-wrapper" style="display: none;">
    <div id="map"></div>
  </div>

  <div id="grades" style="display: none;"></div>
<p>
   <input type="range" id="distance" min="0" max="5000" value="0" onchange="onRangeChange()"> 
  <label id="distanceLabel"> <h3>Pizza spots in your range</h3></label>
</p>
<div id="duration"></div>

<div class="music"> 
Click to play some Pizza music 
<iframe width="20" height="20" src="https://www.youtube.com/embed/Q-wM5Ch8JM8" title="YouTube video player" frameborder="100" border-radius="100" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" ></iframe>
</div>
  <script>
let map;
let markers = [];
let userLocationMarker;


function initMap() {
  clearTimeout(splashPageTimeout);
  document.getElementById("splash-page").style.display = "none";
  document.getElementById("map-wrapper").style.display = "block";
  document.getElementById("grades").style.display = "block";

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } else {
    console.log("Geolocation is not supported by this browser.");
  }
}

window.onload = function() {
  splashPageTimeout = setTimeout(function() {
    document.getElementById("splash-page").style.display = "none";
    document.getElementById("map-wrapper").style.display = "block";
    document.getElementById("grades").style.display = "block";
  }, 70000);
};



    function showPosition(position) {
      const latitude = position.coords.latitude;
      const longitude = position.coords.longitude;

      const mapElement = document.getElementById("map");
      const mapOptions = {
        center: { lat: latitude, lng: longitude },
        zoom: 14,
      };
      map = new google.maps.Map(mapElement, mapOptions);
	  

      // Add marker for user's current location
      userLocationMarker = new google.maps.Marker({
        position: {
          lat: latitude,
          lng: longitude
        },
        map: map,
        title: "Your Location",
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 10,
          strokeColor: "red",
          fillColor: "red",
          fillOpacity: 0.5,
          strokeWeight: 1
        }
        
      });

      // Fetch pizza spot data from the NYC Open Data API with a pizza spot filter
      fetch("https://data.cityofnewyork.us/resource/43nn-pn8j.json?cuisine_description=Pizza")
        .then((response) => response.json())
        .then((data) => {
          // Loop through the pizza spot data and create a marker for each spot
          for (let i = 0; i < data.length; i++) {
            const spot = data[i];
			
            const marker = new google.maps.Marker({
              position: {
                lat: parseFloat(spot.latitude),
                lng: parseFloat(spot.longitude),
              },
              map: map,
              title: spot.dba

              });
			  if (spot.grade) {
    const gradeMarker = new google.maps.Circle({
      strokeColor: "blue",
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor:"blue",
      fillOpacity: 1.6,
      fillBrigthness:2.0,
      map: map,
      center: {
        lat: parseFloat(spot.latitude),
        lng: parseFloat(spot.longitude),
      },
      radius: 80, // Adjust the radius as needed
    });
	

    // Add an event listener to show the grade when the grade marker is clicked
    google.maps.event.addListener(gradeMarker, 'click', function () {
      const gradesElement = document.getElementById("grades");
      gradesElement.innerHTML = "<p>" + spot.dba + ": " + spot.grade + "</p>";
    });
  }
  
// Update the marker click event listener to calculate and display the walking duration
marker.addListener("click", () => {
  const destination = marker.getPosition();
  const directionsService = new google.maps.DirectionsService();
  const directionsRenderer = new google.maps.DirectionsRenderer();
  directionsRenderer.setMap(map);

  const request = {
    origin: userLocationMarker.getPosition(),
    destination: destination,
    travelMode: google.maps.TravelMode.WALKING
  };

  directionsService.route(request, (result, status) => {
    if (status === google.maps.DirectionsStatus.OK) {
      const duration = result.routes[0].legs[0].duration.text;
      const infowindow = new google.maps.InfoWindow({
        content: "<strong>" + spot.dba + "</strong><br>" + duration
      });
      directionsRenderer.setDirections(result);
      infowindow.open(map, marker);
    }
  });
});

			  if (i > 1) {
				marker.setVisible(false)
			  }
			  if (marker.getVisible() && marker.grade) {
      const spot = pizzaSpots[i];
      gradesText += "<p>" + spot.dba + ": " + spot.grade + "</p>";
    }

	if (i > 1) {
                marker.setVisible(false);
              }

              markers.push(marker);
;

              // Add an info window for each marker that shows the pizza spot name and address
              const infowindow = new google.maps.InfoWindow({
                content: "<strong>" + spot.dba + "</strong><br>" + spot.grade
              });
              marker.addListener("click", () => {
                infowindow.open(map, marker);
              });
            }
          });
		  
      }
	  

     

	  function onRangeChange() {
  var distanceRange = document.getElementById("distance");
  var distanceLabel = document.getElementById("distanceLabel");
  distanceLabel.innerHTML = "Distance: " + distanceRange.value + " meters";

  filterMarkers(); 
}

function filterMarkers() {
  const distanceRange = document.getElementById("distance");
  const distance = distanceRange.value;

  for (let i = 0; i < markers.length; i++) {
    const marker = markers[i];
    const distanceFromUser = google.maps.geometry.spherical.computeDistanceBetween(
      marker.getPosition(),
      userLocationMarker.getPosition()
    );

    if (distanceFromUser <= distance) {
      marker.setVisible(true);
    } else {
      marker.setVisible(false);
      
    }
  }
}

function updateInfoBox() {
  const infoBox = document.getElementById("info-box");
  let infoText = "";

  // Loop through the markers and check their grade
  for (let i = 0; i < markers.length; i++) {
    const marker = markers[i];
    if (marker.getVisible() && marker.spot && marker.spot.grade) {
      const spot = marker.spot;
      infoText += "<p>" + spot.dba + ": " + spot.grade + "</p>";
    }
  }

  infoBox.innerHTML = infoText;
}

function showPlacesInRange() {
  const distanceRange = document.getElementById("distance");
  const distance = distanceRange.value;
  let placesText = "";

  // Loop through the markers and add the selected pizza spots to the placesText variable
  for (let i = 0; i < markers.length; i++) {
    const marker = markers[i];
    const distanceFromUser = google.maps.geometry.spherical.computeDistanceBetween(
      marker.getPosition(),
      userLocationMarker.getPosition()
    );

    if (marker.getVisible() && distanceFromUser <= distance) {
      const spot = marker.spot;
      if (spot && spot.grade) {
        placesText += "<p>" + spot.dba + ": " + spot.grade + "</p>";
      }
    }
  }

  const placesElement = document.getElementById("grades");
  placesElement.innerHTML = placesText;
}

function showPlacesInRange() {
  const distanceRange = document.getElementById("distance");
  const distance = distanceRange.value;
  let placesText = "";

  for (let i = 0; i < markers.length; i++) {
    const marker = markers[i];
    const distanceFromUser = google.maps.geometry.spherical.computeDistanceBetween(
      marker.getPosition(),
      userLocationMarker.getPosition()
    );

    if (marker.getVisible() && distanceFromUser <= distance) {
      const spot = marker.spot;
      if (spot && spot.grade) {
        placesText += "<p>" + spot.dba + ": " + spot.grade + "</p>";
      }
    }
  }

  const placesElement = document.getElementById("grades");
  placesElement.innerHTML = placesText;
}

function showGrade() {
  const gradesElement = document.getElementById("grades");
  let gradesText = "";

  // Loop through the markers and check if the marker is visible and has a grade
  for (let i = 0; i < markers.length; i++) {
    const marker = markers[i];
    if (marker.getVisible() && marker.spot && marker.spot.grade) {
      const spot = marker.spot;
      gradesText += "<p>" + spot.dba + ": " + spot.grade + "</p>";
    }
  }

  gradesElement.innerHTML = gradesText;
}

let pizzaSpots = [];
let business = {
  legalName: "ABC Corporation",
  dba: "ABC Inc."
};
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDYI52ysbcITcv1hk6Pm5eWUq8L-m4ASsk&callback=initMap" async defer></script>
</body>